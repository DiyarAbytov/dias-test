# DIYAS — Логика системы (Производство пластика)

**Назначение:** учёт производства пластика от сырья до отгрузки клиенту. Каждый этап заканчивает свою работу и **передаёт** следующему; у каждого сотрудника свои вкладки (доступы); всё идёт по цепочке со статусами.

## Цепочка этапов (передача между вкладками)

```
[Склад сырья]     → приход сырья, остатки → передаёт в Хим. элементы и Рецепты
       ↓
[Хим. элементы]   → план заданий → Выполнено → списание сырья, приход на склад хим. элементов
       ↓
[Рецепты]         → продукт = сырьё + хим. элементы (нормы) → используется в Заказах
       ↓
[Заказы]          → план производства (рецепт, линия, кол-во) → статусы: Создан → В работе → Готово → передаёт в Производство
       ↓
[Смены]           → открыта смена на линии → можно выпускать по заказам этой линии
       ↓
[Производство]    → выпуск партии по заказу → передаёт партию в ОТК
       ↓
[ОТК]             → партии «Ожидают проверки» → Принято/Брак → принятое передаётся на Склад ГП
       ↓
[Склад ГП]        → приёмка с ОТК → партия ГП, остатки → резерв под заказы клиентов → передаёт в Продажа
       ↓
[Продажа]         → заказы клиентов, резерв ГП со склада → передаёт заказ в Отгрузка
       ↓
[Отгрузка]        → оформление отгрузки клиенту → партия ГП «Отгружена» — этап завершён
```

**Справочники и сводки (не передают, но участвуют в цепочке):**
- **Линии** — справочник линий для заказов и смен
- **База клиентов** — справочник клиентов для Продажа и Отгрузка
- **Аналитика** — сводки по всем этапам, цепочка целиком

## Роли и вкладки по этапам

| Этап | Вкладка | Кто действует | Действия | Передаёт |
|------|---------|----------------|----------|----------|
| 1 | Пользователи | Админ | Создать/редактировать сотрудников, доступы к вкладкам | — |
| 2 | Линии | Админ/Планировщик | Справочник производственных линий | — |
| 3 | Склад сырья | Кладовщик/Приёмка | Приход сырья, остатки | Хим. элементы, Рецепты |
| 4 | Хим. элементы | Оператор хим. участка | План заданий → В работу → Выполнено, справочник, остатки | — |
| 5 | Рецепты | Технолог/Планировщик | Состав продукции (сырьё + хим. элементы) | Заказы |
| 6 | Смены | Начальник смены | Открыть/закрыть смену на линии | — |
| 7 | Заказы | Планировщик | Создать заказ (рецепт, линия, кол-во). Статусы: Создан → В работе → Готово | Производство |
| 8 | Производство | Оператор линии | План по заказам → Выпустить партию | ОТК |
| 9 | ОТК | Инспектор ОТК | Ожидают → Проверить → Принято/Брак | Склад ГП |
| 10 | Склад ГП | Кладовщик ГП | Принять партию с ОТК, партии ГП, остатки, резерв | Продажа |
| 11 | Продажа | Менеджер | Заказы клиентов, резерв со склада ГП | Отгрузка |
| 12 | Отгрузка | Кладовщик/Логист | К отгрузке → Оформить отгрузку → Отгружено | — (конец цепочки) |
| — | База клиентов | Менеджер/Продажи | Справочник клиентов для заказов и отгрузок | — |
| — | Аналитика | Руководитель | Сводки по этапам, цепочка, показатели | — |

## Статусы по этапам

- **Задание (хим. элементы):** К выполнению → В работе → Выполнено
- **Заказ на производство:** Создан → В работе → Готово
- **Смена:** Активна → Закрыта
- **Партия (ОТК):** Ожидает ОТК → Принято / Брак
- **Партия ГП:** Доступна / Зарезервирована / Отгружена
- **Заказ клиента (Продажа):** Новый → В работе → Передан в отгрузку
- **Отгрузка:** К отгрузке → Отгружено

## Правило передачи и подтверждения

На каждой вкладке в интерфейсе указано:
- **Поступает из** — откуда пришла работа (предыдущий этап)
- **Передаётся в** — куда этап передаёт результат (следующая вкладка)

**КРИТИЧЕСКИ ВАЖНО:** Каждый этап должен **подтвердить** свою работу. Пока предыдущий этап не подтверждён, следующий этап **не может** использовать его результаты.

### Примеры блокировок:

1. **Хим. элементы → Рецепты:**
   - Химик создаёт хим. элемент из сырья → должен нажать «Подтвердить выполнение»
   - Пока не подтверждено → элемент **недоступен** в Рецептах
   - После подтверждения → элемент появляется на складе хим. элементов → доступен для рецептов

2. **Рецепты → Заказы:**
   - Технолог создаёт рецепт из сырья + подтверждённых хим. элементов
   - Рецепт готов → можно использовать в Заказах

3. **Производство:**
   - Оператор выбирает заказ → одобряет количество
   - Показывается списание со **Склада сырья** и **Склада хим. элементов**
   - При выпуске партии происходит автоматическое списание
   - Партия передаётся в ОТК

4. **ОТК → Склад ГП:**
   - Инспектор проверяет: брак / принято
   - Принятое передаётся на Склад ГПДействия типа «Выпустить», «Проверить», «Принять», «Передать в отгрузку», «Отгрузить» завершают работу этапа и передают данные следующему.
